<p id="notice"><%= notice %></p>

<h1>Magasins</h1>


<div class="container">
  <div class="row">
    <div id="output"></div>
      <input class="bar" type="range" id="distanceVal" value="15" max="50" min="0"/>
    <div id="map"></div>

    <!--<table class="table table-hover">
      <thead>
        <tr>
          <th>Chain</th>
          <th>Name</th>
          <th>Longitude</th>
          <th>Latitude</th>
          <th>Address</th>
          <th>City</th>
          <th>Zip</th>
          <th>Phone</th>
          <th>Country code</th>
          <th colspan="3">Action</th>
        </tr>
      </thead>

      <tbody>
        <% @magasins.each do |magasin| %>
          <tr>
            <td><%= magasin.chain %></td>
            <td><%= magasin.name %></td>
            <td><%= magasin.longitude %></td>
            <td><%= magasin.latitude %></td>
            <td><%= magasin.address %></td>
            <td><%= magasin.city %></td>
            <td><%= magasin.zip %></td>
            <td><%= magasin.phone %></td>
            <td><%= magasin.country_code %></td>
            <td><%= link_to 'Show', magasin %></td>
            <td><%= link_to 'Edit', edit_magasin_path(magasin) %></td>
            <td><%= link_to 'Destroy', magasin, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>

        <% end %>
      </tbody>
    </table> -->

    <br>

    <%= link_to 'New Magasin', new_magasin_path %>
  </div>
</div>

<script>
  var myLatLng = [];

  <% @magasins.each do |magasin| %>
    myLatLng.push({lat: <%= magasin.latitude %>, lng: <%= magasin.longitude %>});
  <% end %>

  function initMap() {

    // Create a map object and specify the DOM element for display.

    var map = new google.maps.Map(document.getElementById('map'), {
      center: new google.maps.LatLng(48.859452, 2.348923),
      scrollwheel: false,
      zoom: 10
    });

    var infoWindow = new google.maps.InfoWindow({map: map});
    var pos = {};

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
        //pos.lat = position.coords.latitude;
        //pos.lng = position.coords.longitude;

        var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };

        infoWindow.setPosition(pos);
        infoWindow.setContent('Location found.');

        map.setCenter(pos);
        map.setZoom(13);

        for (var variable of myLatLng) {
          //console.log(variable);

          var markersArray = [];

          var origin1 = pos;
          var origin2 = variable;

          var a = new google.maps.LatLng(pos);
          var b = new google.maps.LatLng(variable);
          if (google.maps.geometry.spherical.computeDistanceBetween(a , b) < 15000) {
            var marker = new google.maps.Marker({
              map: map,
              position: variable,
            });
          }

        }

      }, function() {
        handleLocationError(true, infoWindow, map.getCenter());
      });
    } else {
      // Browser doesn't support Geolocation
      handleLocationError(false, infoWindow, map.getCenter());
    }
  }

    function deleteMarkers(markersArray) {
      for (var i = 0; i < markersArray.length; i++) {
        markersArray[i].setMap(null);
      }
      markersArray = [];
    }







</script>
